

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>KDataPy Utility functions &mdash; KDataPy 4.8 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '4.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="KDataPy 4.8 documentation" href="index.html" />
    <link rel="up" title="KDataPy Modules" href="code.html" />
    <link rel="next" title="KDataPy Database Access Functions" href="database.html" />
    <link rel="prev" title="KDataPy Modules" href="code.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="database.html" title="KDataPy Database Access Functions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="code.html" title="KDataPy Modules"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">KDataPy 4.8 documentation</a> &raquo;</li>
          <li><a href="code.html" accesskey="U">KDataPy Modules</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="kdatapy-utility-functions">
<h1>KDataPy Utility functions<a class="headerlink" href="#kdatapy-utility-functions" title="Permalink to this headline">¶</a></h1>
<p>This module extends the KDataReader class, the KRawBoloPulseRecords class and the family of KPtaProcessor classes.  It add iteration, provides easy functions to create numpy arrays from KPtaProcessors, and provides event looping functions, allowing you to hook in an analysis function to the loop. This way you don&#8217;t have to write those chunks of code ever again.</p>
<p>The KDataReader class is now iterable and returns a pointer to the KEvent class (KRawEvent, KAmpEvent, KHLAEvent).  The KRawBoloPulseRecord class has been extended in Python. The method getnumpy() was added, which returns a numpy array. An example is shown below.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">KDataPy.util</span>
<span class="kn">import</span> <span class="nn">ROOT</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">KDataReader</span><span class="p">(</span><span class="s">&quot;path/to/file/ma22a000_000.root&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>  <span class="c">#KDataReader is iterable, so you can write for loops like this</span>

   <span class="c">#do something with the event</span>
</pre></div>
</div>
<p>Since TClonesArrays are also iterable objects, you can then write simple Pythonic loops</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">KDataPy.util</span>
<span class="kn">import</span> <span class="nn">ROOT</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">KDataReader</span><span class="p">(</span><span class="s">&quot;path/to/file/ma22a000_000.root&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
   <span class="k">for</span> <span class="n">bolo</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">boloRecords</span><span class="p">():</span>
     <span class="k">for</span> <span class="n">pulse</span> <span class="ow">in</span> <span class="n">bolo</span><span class="o">.</span><span class="n">pulseRecords</span><span class="p">():</span>

           <span class="c">#do something with the data</span>

           <span class="c">#such, as get a numpy array of the pulse trace</span>
           <span class="n">np</span> <span class="o">=</span> <span class="n">pulse</span><span class="o">.</span><span class="n">getnumpy</span><span class="p">()</span>
</pre></div>
</div>
<p>However, why write an event loop ever again? KDataPy.util already does this for you and gives you an easy
way to hook in an analysis function for each pulse or bolometer record.  See the looppulse and loopbolo functions below!</p>
<p>Another useful iteration that has been added is for the KPtaProcessor-based classes (KBaselineRemoval, KIIRFilter, KConvolution, KPulseAnalysisChain, etc....). One can iterate over the input and output pulses for each object.</p>
<p>Here&#8217;s how you would use the iteratble KPtaProcessor.output and KPtaProcessor.input functions</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">KDataPy.util</span>
<span class="kn">import</span> <span class="nn">ROOT</span>

<span class="c">#create some dummy pulse for this example</span>
<span class="n">bas</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">KBaselineRemoval</span><span class="p">()</span>
<span class="n">vp</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">vector</span><span class="p">(</span><span class="s">&quot;double&quot;</span><span class="p">)()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span> <span class="n">vp</span><span class="o">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">bas</span><span class="o">.</span><span class="n">SetInputPulse</span><span class="p">(</span><span class="n">vp</span><span class="p">)</span>
<span class="n">bas</span><span class="o">.</span><span class="n">RunProcess</span><span class="p">()</span>
<span class="c">#</span>


<span class="c">#The OLD way to loop through the output pulse</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bas</span><span class="o">.</span><span class="n">GetOutputPulseSize</span><span class="p">()):</span>
   <span class="k">print</span> <span class="n">bas</span><span class="o">.</span><span class="n">GetOutputPulse</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>

<span class="c">#The Python way</span>
<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">bas</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
  <span class="k">print</span> <span class="n">val</span>

<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">bas</span><span class="o">.</span><span class="n">input</span><span class="p">:</span>
  <span class="k">print</span> <span class="n">val</span>

<span class="c">#Also, you can get the index as well</span>
<span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bas</span><span class="o">.</span><span class="n">output_index</span><span class="p">:</span>
  <span class="k">print</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span>

<span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bas</span><span class="o">.</span><span class="n">input_index</span><span class="p">:</span>
  <span class="k">print</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span>
</pre></div>
</div>
<span class="target" id="module-KDataPy.util"></span><dl class="function">
<dt id="KDataPy.util.concatKdataFiles">
<tt class="descclassname">KDataPy.util.</tt><tt class="descname">concatKdataFiles</tt><big>(</big><em>fileList</em>, <em>outputFileName</em><big>)</big><a class="reference internal" href="_modules/KDataPy/util.html#concatKdataFiles"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#KDataPy.util.concatKdataFiles" title="Permalink to this definition">¶</a></dt>
<dd><p>This function performs a very simple operation. Given a list of KData file names (full path), fileList, it will merge the TTrees
within these files into a single output file with name &#8220;outputFileName&#8221;. This function should work for all types of KData files (Raw, Amp, HLA)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>fileList</strong> (<em>list of full paths to the files</em>) &#8211; The KData files to merge</li>
<li><strong>outputFileName</strong> &#8211; The name of the output KData file</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>[Developer&#8217;s note: This assumes that the name of the TTree within the KData file is called &#8216;t&#8217;]</p>
</dd></dl>

<dl class="function">
<dt id="KDataPy.util.getRootHistFromOutput">
<tt class="descclassname">KDataPy.util.</tt><tt class="descname">getRootHistFromOutput</tt><big>(</big><em>pta</em><big>)</big><a class="reference internal" href="_modules/KDataPy/util.html#getRootHistFromOutput"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#KDataPy.util.getRootHistFromOutput" title="Permalink to this definition">¶</a></dt>
<dd><p>return a ROOT TH1D histogram from the output pulse of a KPtaProcessor (pta)</p>
</dd></dl>

<dl class="function">
<dt id="KDataPy.util.get_as_nparray">
<tt class="descclassname">KDataPy.util.</tt><tt class="descname">get_as_nparray</tt><big>(</big><em>c_pointer</em>, <em>size</em><big>)</big><a class="reference internal" href="_modules/KDataPy/util.html#get_as_nparray"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#KDataPy.util.get_as_nparray" title="Permalink to this definition">¶</a></dt>
<dd><p>return a numpy array from a pointer to data of length &#8216;size&#8217;</p>
</dd></dl>

<dl class="function">
<dt id="KDataPy.util.get_in">
<tt class="descclassname">KDataPy.util.</tt><tt class="descname">get_in</tt><big>(</big><em>pta</em><big>)</big><a class="reference internal" href="_modules/KDataPy/util.html#get_in"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#KDataPy.util.get_in" title="Permalink to this definition">¶</a></dt>
<dd><p>return a numpy array from the input pulse of a KPtaProcessor (pta)</p>
</dd></dl>

<dl class="function">
<dt id="KDataPy.util.get_out">
<tt class="descclassname">KDataPy.util.</tt><tt class="descname">get_out</tt><big>(</big><em>pta</em><big>)</big><a class="reference internal" href="_modules/KDataPy/util.html#get_out"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#KDataPy.util.get_out" title="Permalink to this definition">¶</a></dt>
<dd><p>return a numpy array from the output pulse of a KPtaProcessor (pta)</p>
</dd></dl>

<dl class="function">
<dt id="KDataPy.util.loopbolo">
<tt class="descclassname">KDataPy.util.</tt><tt class="descname">loopbolo</tt><big>(</big><em>data</em>, <em>name=None</em>, <em>match=False</em>, <em>analysisFunction=None</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/KDataPy/util.html#loopbolo"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#KDataPy.util.loopbolo" title="Permalink to this definition">¶</a></dt>
<dd><p>Like looppulse, but just loops through each bolo record for you
and you provide the analysis function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>data</strong> (<em>string path to file or KDataReader object</em>) &#8211; The data file to use.</li>
<li><strong>name</strong> (<em>string</em>) &#8211; The bolometer name you want to analyze</li>
<li><strong>match</strong> (<em>bool</em>) &#8211; if match is True, then the bolometer name needs to exactly match &#8216;name&#8217;. Otherwise, if the bolometer name contains &#8216;name&#8217;, then the data will be analyzed. For example, if you set &#8216;name&#8217;=&#8217;FID&#8217;, then your analysis function will be called for each FID detector in the file</li>
<li><strong>analysisFunction</strong> (<em>function pointer</em>) &#8211; the function that you will define to analyze your pulse. This is a sort of &#8216;callback&#8217; function. Your function will be passed the following arguments: KEvent, KBolometerRecord, <a href="#id1"><span class="problematic" id="id2">**</span></a>kwargs.</li>
<li><strong>kwargs</strong> (<em>keyword argument list</em>) &#8211; all remaining kwargs are pass to the analysisFunction</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>For example</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">myFunction</span><span class="p">(</span><span class="n">theEvent</span><span class="p">,</span> <span class="n">boloRecord</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="k">print</span> <span class="n">boloRecord</span><span class="o">.</span><span class="n">GetDetectorName</span><span class="p">()</span>
  
  <span class="k">for</span> <span class="n">pulse</span> <span class="ow">in</span> <span class="n">boloRecord</span><span class="o">.</span><span class="n">pulseRecords</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">pulse</span><span class="o">.</span><span class="n">GetChannelName</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;myExtraOptions&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;condition1&#39;</span><span class="p">:</span>
        <span class="o">....</span> <span class="n">do</span> <span class="n">some</span> <span class="n">analysis</span><span class="o">....</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="o">....</span> <span class="n">do</span> <span class="n">something</span> <span class="n">different</span><span class="o">....</span>
    
    
<span class="n">util</span><span class="o">.</span><span class="n">loopbolo</span><span class="p">(</span><span class="s">&#39;/path/to/file.root&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;FID&quot;</span><span class="p">,</span> <span class="n">analysisFunction</span><span class="o">=</span><span class="n">myFunction</span><span class="p">,</span> <span class="n">myExtraOptions</span><span class="o">=</span><span class="s">&quot;condition1&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Besides strings, you can pass ANYTHING via the kwargs, in any order, even objects, and pointers to other functions!</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">callMe</span><span class="p">():</span>
  <span class="k">print</span> <span class="s">&#39;I can be called&#39;</span>


<span class="k">def</span> <span class="nf">myFunction</span><span class="p">(</span><span class="n">theEvent</span><span class="p">,</span> <span class="n">boloRecord</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="k">print</span> <span class="n">boloRecord</span><span class="o">.</span><span class="n">GetDetectorName</span><span class="p">()</span>
  
  <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;firstCall&#39;</span><span class="p">]:</span>
    <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;firstCall&#39;</span><span class="p">]()</span>

  <span class="n">hAna</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;heatAna&#39;</span><span class="p">]</span>
  <span class="n">ionAna</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ionAna&#39;</span><span class="p">]</span>

  <span class="k">for</span> <span class="n">pulse</span> <span class="ow">in</span> <span class="n">boloRecord</span><span class="o">.</span><span class="n">pulseRecords</span><span class="p">():</span>
    <span class="k">print</span> <span class="n">pulse</span><span class="o">.</span><span class="n">GetChannelName</span><span class="p">()</span>

    <span class="c">#pick the correct analysis object</span>
    <span class="k">if</span> <span class="n">pulse</span><span class="o">.</span><span class="n">GetIsHeatPulse</span><span class="p">():</span>
      <span class="n">theAna</span> <span class="o">=</span> <span class="n">hAna</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">theAna</span> <span class="o">=</span> <span class="n">ionAna</span>

    <span class="n">theAna</span><span class="o">.</span><span class="n">SetInputPulse</span><span class="p">(</span><span class="n">pulse</span><span class="o">.</span><span class="n">GetTrace</span><span class="p">())</span>
    <span class="n">theAna</span><span class="o">.</span><span class="n">RunProcess</span><span class="p">()</span>
    <span class="n">outTrace</span> <span class="o">=</span> <span class="n">KDataPy</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_out</span><span class="p">(</span><span class="n">theAna</span><span class="p">)</span>
      <span class="o">...</span> <span class="n">do</span> <span class="n">something</span> <span class="o">...</span>


    
<span class="n">chainHeat</span> <span class="o">=</span> <span class="n">KPulseAnalysisChain</span><span class="p">()</span>
<span class="n">chainHeat</span><span class="o">.</span><span class="n">AddProcessor</span><span class="p">(</span> <span class="n">KBaselineRemoval</span><span class="p">()</span> <span class="p">)</span>

<span class="n">chainIon</span> <span class="o">=</span> <span class="n">KPulseAnalysisChain</span><span class="p">()</span>
<span class="n">chainIon</span><span class="o">.</span><span class="n">AddProcessor</span><span class="p">(</span> <span class="n">KBaselineRemoval</span><span class="p">()</span> <span class="p">)</span>
<span class="n">chainIon</span><span class="o">.</span><span class="n">AddProcessor</span><span class="p">(</span> <span class="n">KPatternRemoval</span><span class="p">()</span> <span class="p">)</span>

<span class="n">util</span><span class="o">.</span><span class="n">loopbolo</span><span class="p">(</span><span class="s">&#39;/path/to/file.root&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&quot;FID&quot;</span><span class="p">,</span> <span class="n">analysisFunction</span><span class="o">=</span><span class="n">myFunction</span><span class="p">,</span> <span class="n">heatAna</span> <span class="o">=</span> <span class="n">chainHeat</span><span class="p">,</span> <span class="n">ionAna</span> <span class="o">=</span> <span class="n">chainIon</span><span class="p">,</span> <span class="n">firstCall</span> <span class="o">=</span> <span class="n">callMe</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="KDataPy.util.looppulse">
<tt class="descclassname">KDataPy.util.</tt><tt class="descname">looppulse</tt><big>(</big><em>data</em>, <em>name=None</em>, <em>match=False</em>, <em>pta=None</em>, <em>analysisFunction=None</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/KDataPy/util.html#looppulse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#KDataPy.util.looppulse" title="Permalink to this definition">¶</a></dt>
<dd><p>This function provides you with automatic looping code and gives you the chance for pulse processing. 
This function will loop through a datafile, apply the KPulseProcessor that you provide (in pta), 
and then call the analysisFunction, passing in the pulseRecord, the pta, and all <a href="#id3"><span class="problematic" id="id4">**</span></a>kwargs. 
This function allows for all KData types (Raw, Amp, HLA). Only events in Raw data files are processed with the
KPtaProcessor object, of course.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>data</strong> (<em>string path to file or KDataReader object</em>) &#8211; The data file to use.</li>
<li><strong>name</strong> (<em>string</em>) &#8211; The channel name you want to analyze</li>
<li><strong>match</strong> (<em>bool</em>) &#8211; if match is True, then the detector name needs to exactly match &#8216;name&#8217;. Otherwise, if the pulse channel name contains &#8216;name&#8217;, then the data will be analyzed. For example, if you set &#8216;name&#8217;=&#8217;chal&#8217;, then you will probably analyze all heat channels</li>
<li><strong>pta</strong> (<em>KPtaProcessor object</em>) &#8211; a KPtaProcessor that will be automatically called for each pulse</li>
<li><strong>analysisFunction</strong> (<em>function pointer</em>) &#8211; the function that you will define to analyze your pulse. This is a sort of &#8216;callback&#8217; function. Your function must have three arguments(KEvent, KBoloPulseRecord, KPtaProcessor, <a href="#id5"><span class="problematic" id="id6">**</span></a>kwargs). The KPtaProcessor will be the same object that you pass into pta</li>
<li><strong>kwargs</strong> (<em>keyword argument list</em>) &#8211; all kwargs are pass to the analysisFunction</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Example 1</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">KDataPy</span> <span class="kn">import</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">ROOT</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">gSystem</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="s">&#39;libkpta&#39;</span><span class="p">)</span>

<span class="c">#here i define the analysis function</span>
<span class="k">def</span> <span class="nf">myFunction</span><span class="p">(</span><span class="n">theEvent</span><span class="p">,</span> <span class="n">pulseRecord</span><span class="p">,</span> <span class="n">ptaObject</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="k">print</span> <span class="n">pulseRecord</span><span class="o">.</span><span class="n">GetChannelName</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">ptaObject</span> <span class="o">!=</span> <span class="bp">None</span>
    <span class="n">pulsetrace</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_out</span><span class="p">(</span><span class="n">pta</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span> <span class="n">pulsetrace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pulse</span><span class="o">.</span><span class="n">GetTrace</span><span class="p">())</span>

  <span class="k">print</span> <span class="s">&#39;the pulse maximum is&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">pulsetrace</span><span class="p">),</span> <span class="s">&#39;at bin&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">pulsetrace</span><span class="p">)</span>

<span class="c">#a KPtaProcessor object that will analyse each pulse</span>
<span class="n">bas</span> <span class="o">=</span> <span class="n">KBaselineRemoval</span><span class="p">()</span>

<span class="n">util</span><span class="o">.</span><span class="n">looppulse</span><span class="p">(</span><span class="s">&#39;path/to/kdatafile.root&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;ZM1&#39;</span><span class="p">,</span> <span class="n">pta</span> <span class="o">=</span> <span class="n">bas</span><span class="p">,</span> <span class="n">analysisFunction</span> <span class="o">=</span> <span class="n">myFunction</span><span class="p">)</span>
</pre></div>
</div>
<p>Example 2</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">KDataPy</span> <span class="kn">import</span> <span class="n">util</span>
<span class="kn">from</span> <span class="nn">ROOT</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">gSystem</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="s">&#39;libkpta&#39;</span><span class="p">)</span>

<span class="c">#here i define the analysis function</span>
<span class="k">def</span> <span class="nf">myFunction</span><span class="p">(</span><span class="n">theEvent</span><span class="p">,</span> <span class="n">pulseRecord</span><span class="p">,</span> <span class="n">ptaObject</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="k">print</span> <span class="n">pulseRecord</span><span class="o">.</span><span class="n">GetChannelName</span><span class="p">()</span>

  <span class="k">if</span> <span class="n">ptaObject</span> <span class="o">!=</span> <span class="bp">None</span>
    <span class="n">pulsetrace</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_out</span><span class="p">(</span><span class="n">pta</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span> <span class="n">pulsetrace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pulse</span><span class="o">.</span><span class="n">GetTrace</span><span class="p">())</span>

  <span class="k">print</span> <span class="s">&#39;the pulse maximum is&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">pulsetrace</span><span class="p">),</span> <span class="s">&#39;at bin&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">pulsetrace</span><span class="p">)</span>

<span class="n">bas</span> <span class="o">=</span> <span class="n">KBaselineRemoval</span><span class="p">()</span>
<span class="n">pat</span> <span class="o">=</span> <span class="n">KPatternRemoval</span><span class="p">()</span>
<span class="n">chain</span> <span class="o">=</span> <span class="n">KPulseAnalysisChain</span><span class="p">()</span>
<span class="n">chain</span><span class="o">.</span><span class="n">AddProcessor</span><span class="p">(</span><span class="n">bas</span><span class="p">)</span>
<span class="n">chain</span><span class="o">.</span><span class="n">AddProcessor</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span>

<span class="n">util</span><span class="o">.</span><span class="n">looppulse</span><span class="p">(</span><span class="s">&#39;/sps/edelweis/kdata/data/raw/me20a010_010.root&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;ZM1&#39;</span><span class="p">,</span> <span class="n">pta</span> <span class="o">=</span> <span class="n">chain</span><span class="p">,</span> <span class="n">analysisFunction</span> <span class="o">=</span> <span class="n">myFunction</span><span class="p">)</span>
</pre></div>
</div>
<p>Example 3 - using kwargs</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">KDataPy</span> <span class="kn">import</span> <span class="n">util</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">ROOT</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">gSystem</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="s">&#39;libkpta&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">myAnalysis</span><span class="p">(</span><span class="n">theEvent</span><span class="p">,</span> <span class="n">pulse</span><span class="p">,</span> <span class="n">pta</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">pta</span> <span class="o">!=</span> <span class="bp">None</span>
    <span class="n">pulsetrace</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">get_out</span><span class="p">(</span><span class="n">pta</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span> <span class="n">pulsetrace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pulse</span><span class="o">.</span><span class="n">GetTrace</span><span class="p">())</span>
  
  <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;myExtraOption&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;printMin&#39;</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;the pulse minimum is&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">pulsetrace</span><span class="p">),</span> <span class="s">&#39;at bin&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">pulsetrace</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&#39;the pulse maximum is&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">pulsetrace</span><span class="p">),</span> <span class="s">&#39;at bin&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">pulsetrace</span><span class="p">)</span>
    
<span class="n">bas</span> <span class="o">=</span> <span class="n">KBaselineRemoval</span><span class="p">()</span>
<span class="n">pat</span> <span class="o">=</span> <span class="n">KPatternRemoval</span><span class="p">()</span>
<span class="nb">filter</span> <span class="o">=</span> <span class="n">KIIRSecondOrder</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">)</span>  <span class="c">#the &quot;a&quot; and &quot;b&quot; variables can be calculated by external tools (such as Scipy.signal)</span>
<span class="n">chain</span> <span class="o">=</span> <span class="n">KPulseAnalysisChain</span><span class="p">()</span>
<span class="n">chain</span><span class="o">.</span><span class="n">AddProcessor</span><span class="p">(</span><span class="n">bas</span><span class="p">)</span>
<span class="n">chain</span><span class="o">.</span><span class="n">AddProcessor</span><span class="p">(</span><span class="n">pat</span><span class="p">)</span>
<span class="n">chain</span><span class="o">.</span><span class="n">AddProcessor</span><span class="p">(</span><span class="nb">filter</span><span class="p">)</span>

<span class="n">util</span><span class="o">.</span><span class="n">looppulse</span><span class="p">(</span><span class="s">&#39;/sps/edelweis/kdata/data/raw/me20a010_010.root&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;ZM1&#39;</span><span class="p">,</span> <span class="n">pta</span> <span class="o">=</span> <span class="n">chain</span><span class="p">,</span> <span class="n">analysisFunction</span> <span class="o">=</span> <span class="n">myAnalysis</span><span class="p">,</span> <span class="n">myExtraOption</span><span class="o">=</span><span class="s">&quot;printMin&quot;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="KDataPy.util.plotpulse">
<tt class="descclassname">KDataPy.util.</tt><tt class="descname">plotpulse</tt><big>(</big><em>data</em>, <em>name=None</em>, <em>match=False</em>, <em>pta=None</em>, <em>analysisFunction=None</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/KDataPy/util.html#plotpulse"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#KDataPy.util.plotpulse" title="Permalink to this definition">¶</a></dt>
<dd><p>Exactly like looppulse, but will plot each raw pulse on screen and wait for you to hit the &#8216;Enter&#8217;
key in the shell before continuing. In fact, this function calls looppulse. This is a nice way to visualize what is happening
to the pulses. Additionally, if you don&#8217;t provide any analysisFunction, it will be a
nice event viewer just to look at the data.  This function will only work with KData Raw-level files. That is, its only
meant for plotting the pulse traces, which only exist in the raw data files. Otherwise, this will raise an exception at run-time.
This function plot to matplotlib figure(0)! So, don&#8217;t use figure(0) or it will be cleared and a pulse will be drawn.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>data</strong> (<em>string path to file or KDataReader object</em>) &#8211; The data file to use.</li>
<li><strong>name</strong> (<em>string</em>) &#8211; The channel name you want to analyze</li>
<li><strong>match</strong> (<em>bool</em>) &#8211; if match is True, then the pulse channel name needs to exactly match &#8216;name&#8217;. Otherwise, if the pulse channel name contains &#8216;name&#8217;, then the data will be analyzed. For example, if you set &#8216;name&#8217;=&#8217;chal&#8217;, then you will probably analyze all heat channels</li>
<li><strong>pta</strong> (<em>KPtaProcessor object</em>) &#8211; a KPtaProcessor that will be automatically called for each pulse</li>
<li><strong>analysisFunction</strong> (<em>function pointer</em>) &#8211; the function that you will define to analyze your pulse. This is a sort of &#8216;callback&#8217; function. Your function must have three arguments(KEvent, KBoloPulseRecord, KPtaProcessor, <a href="#id7"><span class="problematic" id="id8">**</span></a>kwargs). The KPtaProcessor will be the same object that you pass into pta</li>
<li><strong>kwargs</strong> (<em>keyword argument list</em>) &#8211; all kwargs are pass to the analysisFunction</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Example Event Viewer. This will just print to screen every pulse shape for any channel with &#8220;ZM&#8221; in its name</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">KDataPy</span> <span class="kn">import</span> <span class="n">util</span>

<span class="n">util</span><span class="o">.</span><span class="n">plotpulse</span><span class="p">(</span><span class="s">&#39;/sps/edelweis/kdata/data/raw/me20a010_010.root&#39;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;ZM&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="code.html"
                        title="previous chapter">KDataPy Modules</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="database.html"
                        title="next chapter">KDataPy Database Access Functions</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/util.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="database.html" title="KDataPy Database Access Functions"
             >next</a> |</li>
        <li class="right" >
          <a href="code.html" title="KDataPy Modules"
             >previous</a> |</li>
        <li><a href="index.html">KDataPy 4.8 documentation</a> &raquo;</li>
          <li><a href="code.html" >KDataPy Modules</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Adam Cox, KIT.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>