

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>kdatapy utility functions &mdash; kdatapy 4.8 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '4.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="kdatapy 4.8 documentation" href="index.html" />
    <link rel="up" title="kdatapy modules" href="code.html" />
    <link rel="next" title="kdatapy database access" href="database.html" />
    <link rel="prev" title="kdatapy modules" href="code.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="database.html" title="kdatapy database access"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="code.html" title="kdatapy modules"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">kdatapy 4.8 documentation</a> &raquo;</li>
          <li><a href="code.html" accesskey="U">kdatapy modules</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="kdatapy-utility-functions">
<h1>kdatapy utility functions<a class="headerlink" href="#kdatapy-utility-functions" title="Permalink to this headline">Â¶</a></h1>
<p>This module also extends the KDataReader class and the family of KPtaProcessor classes to be iterable. This module also provides easy functions to create numpy arrays from KPtaProcessors and to provide event looping functions, allowing you to hook in an analysis function to the loop. This way you don&#8217;t have to write those chunks of code ever again.</p>
<p>The KDataReader class itself is iterable and returns a pointer to the KEvent class (KRawEvent, KAmpEvent, KHLAEvent).  The KRawBoloPulseRecord class is also iterable, returning each value of the pulse trace itself.
However, its recommended that you use the getnumpy() utility function to get a numpy array. An example is shown below.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">KDataPy.util</span>
<span class="kn">import</span> <span class="nn">ROOT</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">KDataReader</span><span class="p">(</span><span class="s">&quot;path/to/file/ma22a000_000.root&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>

   <span class="c">#do something with the event</span>
</pre></div>
</div>
<p>Since TClonesArrays are iterable objects, you can then write simple Pythonic loops</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">KDataPy.util</span>
<span class="kn">import</span> <span class="nn">ROOT</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">KDataReader</span><span class="p">(</span><span class="s">&quot;path/to/file/ma22a000_000.root&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
   <span class="k">for</span> <span class="n">bolo</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">boloRecords</span><span class="p">():</span>
     <span class="k">for</span> <span class="n">pulse</span> <span class="ow">in</span> <span class="n">bolo</span><span class="o">.</span><span class="n">pulseRecords</span><span class="p">():</span>
           <span class="c">#do something with the event</span>

           <span class="c">#create a C++ std vector</span>
           <span class="n">vp</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">vector</span><span class="p">(</span><span class="s">&quot;double&quot;</span><span class="p">)()</span>
           <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">pulse</span><span class="p">:</span> <span class="n">vp</span><span class="o">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

           <span class="c">#or, perhaps better, get a numpy array</span>
           <span class="n">np</span> <span class="o">=</span> <span class="n">pulse</span><span class="o">.</span><span class="n">getnumpy</span><span class="p">()</span>
</pre></div>
</div>
<p>However, why write an event loop ever again? KDataPy.util already does this for you and gives you an easy
way to hook in an analysis function for each pulse or bolometer record.  See the looppulse and loopbolo functions below.</p>
<p>Another useful iteration that has been added is for the KPtaProcessor-based classes (KBaselineRemoval, KIIRFilter, KConvolution, KPulseAnalysisChain, etc....). One can iterate over the input and output pulses for each object.</p>
<p>Here&#8217;s how you would use the iteratble KPtaProcessor.output and KPtaProcessor.input functions</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">KDataPy.util</span>
<span class="kn">import</span> <span class="nn">ROOT</span>

<span class="c">#create a dummy pulse</span>
<span class="n">bas</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">KBaselineRemoval</span><span class="p">()</span>
<span class="n">vp</span> <span class="o">=</span> <span class="n">ROOT</span><span class="o">.</span><span class="n">std</span><span class="o">.</span><span class="n">vector</span><span class="p">(</span><span class="s">&quot;double&quot;</span><span class="p">)()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span> <span class="n">vp</span><span class="o">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">bas</span><span class="o">.</span><span class="n">RunProcess</span><span class="p">()</span>
<span class="c">#</span>


<span class="c">#The OLD way to loop through the output pulse</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">bas</span><span class="o">.</span><span class="n">GetOutputPulseSize</span><span class="p">()):</span>
   <span class="k">print</span> <span class="n">bas</span><span class="o">.</span><span class="n">GetOutputPulse</span><span class="p">()[</span><span class="n">i</span><span class="p">]</span>

<span class="c">#The Python way</span>
<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">bas</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
  <span class="k">print</span> <span class="n">val</span>

<span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">bas</span><span class="o">.</span><span class="n">input</span><span class="p">:</span>
  <span class="k">print</span> <span class="n">val</span>

<span class="c">#Also, you can get the index as well</span>
<span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bas</span><span class="o">.</span><span class="n">output_index</span><span class="p">:</span>
  <span class="k">print</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span>

<span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">bas</span><span class="o">.</span><span class="n">input_index</span><span class="p">:</span>
  <span class="k">print</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="code.html"
                        title="previous chapter">kdatapy modules</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="database.html"
                        title="next chapter">kdatapy database access</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/util.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="database.html" title="kdatapy database access"
             >next</a> |</li>
        <li class="right" >
          <a href="code.html" title="kdatapy modules"
             >previous</a> |</li>
        <li><a href="index.html">kdatapy 4.8 documentation</a> &raquo;</li>
          <li><a href="code.html" >kdatapy modules</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, adam cox, kit.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>